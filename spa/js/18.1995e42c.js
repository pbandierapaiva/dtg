(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[18],{"710b":function(e,a,t){"use strict";t.r(a);var o=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("q-page",{staticClass:"flex flex-center",staticStyle:{"padding-bottom":"50%"}},[t("q-list",{staticClass:"full-width"},[t("q-expansion-item",{staticClass:"bg-info text-grey-1 text-center",attrs:{label:"Opções de consulta",group:"opcoes_consulta_paciente",dense:""}},[t("q-form",{staticClass:"bg-white flex-center full-width row",on:{submit:e.onSubmit,reset:e.onReset}},[t("q-input",{staticClass:"q-pa-xs col-12 col-sm-6 col-md-3 col-lg-3",attrs:{label:"Nome","max-length":"250",dense:""},model:{value:e.consultaUsuario.nome,callback:function(a){e.$set(e.consultaUsuario,"nome",a)},expression:"consultaUsuario.nome"}}),t("q-input",{staticClass:"q-pa-xs col-12 col-sm-6 col-md-2 col-lg-1",attrs:{label:"CPF",mask:"###.###.###-##","max-length":"11",rules:[function(e){return 0==e.length||11==e.length||"O CPF deve ter 11 dígitos"}],"unmasked-value":"",dense:""},model:{value:e.consultaUsuario.cpf,callback:function(a){e.$set(e.consultaUsuario,"cpf",a)},expression:"consultaUsuario.cpf"}}),t("q-input",{staticClass:"q-pa-xs col-12 col-sm-5 col-md-3 col-lg-3",attrs:{label:"Preceptor","max-length":"250",dense:""},model:{value:e.consultaUsuario.preceptor,callback:function(a){e.$set(e.consultaUsuario,"preceptor",a)},expression:"consultaUsuario.preceptor"}}),t("q-btn",{staticClass:"q-pa-xs q-ma-md col-xs-5 col-sm-3 col-md-2 col-lg-1",attrs:{label:"Consultar",type:"submit",color:"primary",dense:""}})],1)],1)],1),t("div",{staticClass:"q-pa-sm full-width"},[t("q-table",{staticClass:"q-mt-xs",attrs:{data:e.dados,columns:e.columns,"row-key":"name",pagination:e.pagination,"visible-columns":1==e.mostrarMais?e.visibleColumnsCompleto:e.visibleColumnsPadrao},on:{"update:pagination":function(a){e.pagination=a}},scopedSlots:e._u([{key:"top",fn:function(a){return[t("b",[e._v("Relatório Abandono Paciente")]),t("q-toggle",{attrs:{val:"mostrarMais",label:"Expandir"},model:{value:e.mostrarMais,callback:function(a){e.mostrarMais=a},expression:"mostrarMais"}}),t("q-btn",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"q-ml-md",attrs:{flat:"",round:"",dense:"",icon:a.inFullscreen?"fullscreen_exit":"fullscreen"},on:{click:a.toggleFullscreen}})]}},{key:"header",fn:function(a){return[t("q-tr",[t("q-th",{key:"id_usuario",attrs:{props:a}}),t("q-th",{key:"id_mola",attrs:{props:a}}),t("q-th",{key:"numero_mola",attrs:{props:a}},[e._v("Nº mola")]),t("q-th",{key:"nome_paciente",attrs:{props:a}},[e._v("Nome")]),t("q-th",{key:"cpf",attrs:{props:a}},[e._v("CPF")]),t("q-th",{key:"nome_preceptor",attrs:{props:a}},[e._v("Preceptor ")]),t("q-th",{key:"ultima_paciente",attrs:{props:a}},[e._v("UMP"),t("q-btn",{attrs:{icon:"help",color:"primary",flat:"",dense:""}},[t("q-tooltip",[e._v("\n                UMP - Última mensagem enviada pela paciente\n              ")])],1)],1),t("q-th",{key:"ultima_medico",attrs:{props:a}},[e._v("UMM"),t("q-btn",{attrs:{icon:"help",color:"primary",flat:"",dense:""}},[t("q-tooltip",[e._v("\n                UMM - Última mensagem enviada pelo médico\n              ")])],1)],1),t("q-th",{key:"tel_proprio",attrs:{props:a}},[e._v("Telefone Próprio")]),t("q-th",{key:"tel_contato",attrs:{props:a}},[e._v("Telefone Contato")]),t("q-th",{key:"nome_contato",attrs:{props:a}},[e._v("Nome Contato")]),t("q-th",{key:"email",attrs:{props:a}},[e._v("E-mail")]),t("q-th",{key:"enviar_mensagem",attrs:{props:a}},[e._v("Enviar Mensagem")])],1)]}},{key:"body",fn:function(a){return[t("q-tr",{class:[e.tempoUltimaMsg(a.row.ultima_paciente)?"bg-warning":""],attrs:{props:a}},[t("q-td",{key:"id_usuario",attrs:{props:a}},[e._v("\n            "+e._s(a.row.id_usuario)+"\n          ")]),t("q-td",{key:"id_r_mola",attrs:{props:a}},[e._v("\n            "+e._s(a.row.id_r_mola)+"\n          ")]),t("q-td",{key:"numero_mola",attrs:{props:a}},[e._v("\n            "+e._s(a.row.numero_mola)+"\n          ")]),t("q-td",{key:"nome_paciente",attrs:{props:a}},[e.comparaDataMensagens(a.row.ultima_paciente,a.row.ultima_medico)?t("q-icon",{attrs:{name:"circle",color:"positive"}},[t("q-tooltip",[t("span",{directives:[{name:"show",rawName:"v-show",value:1==e.comparaDataMensagens(a.row.ultima_paciente,a.row.ultima_medico)&&null!=a.row.ultima_paciente,expression:"\n                    comparaDataMensagens(\n                      props.row.ultima_paciente,\n                      props.row.ultima_medico\n                    ) == true && props.row.ultima_paciente != null\n                  "}]},[e._v("\n                  Paciente está aguardando resposta")]),t("span",{directives:[{name:"show",rawName:"v-show",value:null==a.row.ultima_paciente,expression:"props.row.ultima_paciente == null"}]},[e._v("\n                  Paciente ainda não respondeu a mensagem dos médicos")])])],1):e._e(),e._v("\n            "+e._s(a.row.nome_paciente)+"\n          ")],1),t("q-td",{key:"cpf",attrs:{props:a}},[e._v("\n            "+e._s(a.row.cpf)+"\n          ")]),t("q-td",{key:"nome_preceptor",attrs:{props:a}},[e._v("\n            "+e._s(a.row.nome_preceptor)+"\n          ")]),t("q-td",{key:"ultima_paciente",attrs:{props:a}},[t("q-btn",{attrs:{icon:a.row.ultima_paciente>a.row.ultima_medico?"chat_bubble":"chat_bubble_outline",color:null==a.row.ultima_paciente?"white":a.row.ultima_paciente>a.row.ultima_medico?"primary":"dark",flat:""}},[t("q-tooltip",[e._v("\n                "+e._s(null!=a.row.ultima_paciente?a.row.ultima_paciente:"Não há mensagens")+"\n              ")])],1)],1),t("q-td",{key:"ultima_medico",attrs:{props:a}},[t("q-btn",{attrs:{icon:a.row.ultima_medico>a.row.ultima_paciente?"chat_bubble":"chat_bubble_outline",color:null==a.row.ultima_medico?"white":a.row.ultima_medico>a.row.ultima_paciente?"primary":"dark",flat:"",dense:""}},[t("q-tooltip",[e._v("\n                "+e._s(null!=a.row.ultima_medico?a.row.ultima_medico:"Não há mensagens")+"\n              ")])],1)],1),t("q-td",{key:"tel_proprio",attrs:{props:a}},[e._v("\n            "+e._s(a.row.tel_proprio)+"\n          ")]),t("q-td",{key:"tel_contato",attrs:{props:a}},[e._v("\n            "+e._s(a.row.tel_contato)+"\n          ")]),t("q-td",{key:"nome_contato",attrs:{props:a}},[e._v("\n            "+e._s(a.row.nome_contato)+"\n          ")]),t("q-td",{key:"email",attrs:{props:a}},[e._v("\n            "+e._s(a.row.email)+"\n          ")]),t("q-td",{key:"enviar_mensagem",attrs:{props:a}},[t("q-btn",{attrs:{id:"enviar_mensagem",to:{name:"cadastro_registro_mola",params:{id_paciente:a.row.id_usuario,id_mola:a.row.id_r_mola}},flat:"",dense:"",icon:"send"}})],1)],1)]}}])}),t("br")],1)],1)},s=[],n=t("ded3"),r=t.n(n),i=(t("e6cf"),t("ddb0"),t("4e82"),t("2f62")),l={name:"PageIndex",data(){return{mostrarMais:!1,consultaUsuario:{nome:"",cpf:"",preceptor:"",usuario_logado:null},visibleColumnsCompleto:["numero_mola","nome_paciente","cpf","nome_preceptor","ultima_medico","ultima_paciente","tel_proprio","tel_contato","nome_contato","email","enviar_mensagem"],visibleColumnsPadrao:["numero_mola","nome_paciente","cpf","ultima_medico","ultima_paciente","tel_contato","enviar_mensagem"],pagination:{rowsPerPage:10},columns:[{name:"id_usuario",label:"Id Paciente",align:"left"},{name:"id_r_mola",label:"Id Mola",align:"left"},{name:"numero_mola",label:"Nº Mola",align:"left"},{name:"nome_paciente",label:"Nome",align:"left"},{name:"cpf",label:"CPF",align:"left"},{name:"nome_preceptor",label:"Preceptor",align:"left"},{name:"ultima_paciente",label:"UMP",align:"left"},{name:"ultima_medico",label:"UMM",align:"left"},{name:"tel_proprio",label:"Telefone Próprio",align:"left"},{name:"tel_contato",label:"Telefone de Contato",align:"left"},{name:"nome_contato",label:"Nome p/ Contato",align:"left"},{name:"email",label:"E-mail",align:"left"},{name:"enviar_mensagem",label:"Enviar Mensagem",align:"center"}],dados:[],listaMolas:[]}},async mounted(){this.consultaUsuario.id_inst=this.dadosUsuarioLogado.id_inst,this.consultaUsuario.usuario_logado=this.dadosUsuarioLogado.id_usuario;let e=await this.consultarRelatorio(this.consultaUsuario,!0);e=e.resultado.map((async e=>{await this.carregarRegistrosMola(e.id_usuario);let a="";for(let t=0;t<this.listaMolas.length;t++)e.id_r_mola==this.listaMolas[t].id_r_mola&&(a=a.concat(t+1),a=a.concat("ª"));return e.id_usuario=e.id_usuario,e.id_r_mola=e.id_r_mola,e.numero_mola=a,e.nome_paciente=e.nome_paciente,e.cpf=e.cpf,e.nome_preceptor=e.nome_preceptor,e.ativo=Boolean(e.ativo),e})),Promise.all(e).then((e=>{this.dados=e,this.dados=this.dados.sort((function(e,a){return 0==e.nome_paciente.localeCompare(a.nome_paciente)?e.id_r_mola<a.id_r_mola?-1:1:e.nome_paciente.localeCompare(a.nome_paciente)}))})).catch((e=>{console.error(e)}))},methods:{carregarRegistrosMola(e){return new Promise(((a,t)=>{this.$axios.post("/dados_r_mola",{id_paciente:e}).then((e=>{this.listaMolas=[];for(let a=0;a<e.data.resultado.length;a++)this.listaMolas.unshift(e.data.resultado[a]);a(e.data.resultado)})).catch((e=>{this.$store.dispatch("principal/verificaErro",e),t(e)}))}))},delegarUsuario(e){this.$store.dispatch("principal/delegarUsuario",e).then((()=>{}))},async onSubmit(){let e=await this.consultarRelatorio(this.consultaUsuario);e=e.resultado.map((async e=>{await this.carregarRegistrosMola(e.id_usuario);let a="";for(let t=0;t<this.listaMolas.length;t++)e.id_r_mola==this.listaMolas[t].id_r_mola&&(a=a.concat(t+1),a=a.concat("ª"));return e.id_usuario=e.id_usuario,e.id_r_mola=e.id_r_mola,e.numero_mola=a,e.nome_paciente=e.nome_paciente,e.cpf=e.cpf,e.nome_preceptor=e.nome_preceptor,e.ativo=Boolean(e.ativo),e})),Promise.all(e).then((e=>{this.dados=e,this.dados=this.dados.sort((function(e,a){return 0==e.nome_paciente.localeCompare(a.nome_paciente)?e.id_r_mola<a.id_r_mola?-1:1:e.nome_paciente.localeCompare(a.nome_paciente)}))})).catch((e=>{console.error(e)}))},onReset(){},async consultarRelatorio(e){return new Promise(((a,t)=>{this.$axios.post("/relatorio/abandono_paciente",e).then((e=>{console.log("response ",e.data),a(e.data)})).catch((e=>{this.$store.dispatch("principal/verificaErro",e),t(e)}))}))},comparaDataMensagens(e,a){if(null!=e&&null!=a){let t=e.substr(0,2),o=e.substr(3,2),s=e.substr(6,4),n=e.substr(11,2),r=e.substr(14,2),i=e.substr(17,2),l=new Date(s,o,t,n,r,i).getTime(),c=a.substr(0,2),m=a.substr(3,2),p=a.substr(6,4),u=a.substr(11,2),_=a.substr(14,2),d=a.substr(17,2),b=new Date(p,m,c,u,_,d).getTime(),g=l>b;return g}return!0},tempoUltimaMsg(e){if(null!=e){let a=e.substr(0,2),t=e.substr(3,2),o=e.substr(6,4),s=e.substr(11,2),n=e.substr(14,2),r=e.substr(17,2),i=new Date(o,t,a,s,n,r).getTime(),l=(new Date).getTime(),c=l-i,m=c/864e5;return m>21}return!0}},computed:r()({},Object(i["c"])("principal",["usuarioLogado","dadosUsuarioLogado"]))},c=l,m=t("2877"),p=t("9989"),u=t("1c1c"),_=t("3b73"),d=t("0378"),b=t("27f9"),g=t("9c40"),h=t("eaac"),f=t("9564"),w=t("bd08"),v=t("357e"),q=t("05c0"),y=t("db86"),k=t("0016"),M=t("eebe"),C=t.n(M),x=Object(m["a"])(c,o,s,!1,null,null,null);a["default"]=x.exports;C()(x,"components",{QPage:p["a"],QList:u["a"],QExpansionItem:_["a"],QForm:d["a"],QInput:b["a"],QBtn:g["a"],QTable:h["a"],QToggle:f["a"],QTr:w["a"],QTh:v["a"],QTooltip:q["a"],QTd:y["a"],QIcon:k["a"]})}}]);