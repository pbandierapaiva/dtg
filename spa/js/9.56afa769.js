(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[9],{"29fe":function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"row"},[a("div",{staticClass:"q-mx-auto col-4"},[a("q-scroll-area",{ref:"chatArea",staticClass:"full-width",staticStyle:{height:"300px"},on:{scroll:e.scrollinfo}},e._l(e.mensagens,(function(t){return a("q-chat-message",{key:t.id,attrs:{name:t.remetente,text:[t.texto],sent:t.remetenteid==e.dadosUsuarioLogado.id_usuario}})})),1)],1),a("q-form",{staticClass:"row full-width on-left q-mb-md",on:{submit:e.enviarMensagem}},[a("div",{staticClass:"q-mx-auto col-4 row "},[a("q-input",{ref:"mensagem",staticClass:"q-pa-xs col-9",attrs:{label:"Mensagem","input-style":"height:40px",autofocus:"",dense:"",type:"textarea",outlined:"",maxlength:"250",counter:""},model:{value:e.chat.mensagem,callback:function(t){e.$set(e.chat,"mensagem",t)},expression:"chat.mensagem"}}),a("q-btn",{staticClass:"q-mt-xs col-3",staticStyle:{height:"40px"},attrs:{label:"Enviar",type:"submit",color:"primary",dense:""}})],1)])],1)},n=[],o=a("ded3"),i=a.n(o),r=(a("e6cf"),a("2f62")),l={name:"PageIndex",data(){return{socket:{},chat:{mensagem:""},mensagens:[],scrollsize:0}},props:["id_paciente"],watch:{scrollsize:function(e){this.$refs.chatArea.setScrollPosition(e-300,100)},id_paciente:async function(){await this.carregarMensagens()}},computed:i()({},Object(r["c"])("principal",["dadosUsuarioLogado"])),sockets:{mensagem:function(e){let t={id:e.id,remetenteid:e.remetenteid,remetente:e.remetente,texto:e.msg};this.mensagens.push(t)},mensagensAnteriores:function(e){this.mensagens=[];for(let t in e){let a={id:e[t].idMsg,remetenteid:e[t].remetenteid,remetente:e[t].remetente,texto:e[t].msg};this.mensagens.push(a)}}},mounted(){this.carregarMensagens()},destroyed(){this.$socket.emit("logout",this.id_paciente)},methods:{carregarMensagens(){if(Boolean(this.id_paciente)){let e=this.id_paciente,t=this.dadosUsuarioLogado.id_usuario;this.$socket.emit("login",{id_paciente:e,id_usuario:t})}},enviarMensagem(){let e={remetenteid:this.dadosUsuarioLogado.id_usuario,remetente:this.dadosUsuarioLogado.nome,destinatario:this.id_paciente,msg:this.chat.mensagem};this.$socket.emit("enviarMensagem",e),this.chat.mensagem="",this.$refs.mensagem.focus()},scrollinfo(e){const t=e.verticalSize;this.scrollsize=t}}},c=l,m=a("2877"),u=a("4983"),d=a("8169"),p=a("0378"),g=a("27f9"),f=a("9c40"),h=a("eebe"),b=a.n(h),_=Object(m["a"])(c,s,n,!1,null,null,null);t["a"]=_.exports;b()(_,"components",{QScrollArea:u["a"],QChatMessage:d["a"],QForm:p["a"],QInput:g["a"],QBtn:f["a"]})},ee32:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",{staticClass:"flex flex-center",staticStyle:{"padding-bottom":"135%"}},[a("q-list",{staticClass:"full-width"},[a("q-expansion-item",{staticClass:"bg-info text-grey-1 text-center",attrs:{label:"Opções de consulta",group:"opcoes_consulta_paciente",dense:""}},[a("q-form",{staticClass:"bg-white flex-center full-width row",on:{submit:e.onSubmit,reset:e.onReset}},[a("q-input",{staticClass:"q-pa-xs col-12 col-sm-5 col-md-3 col-lg-3",attrs:{label:"Nome",dense:""},model:{value:e.consultaChat.nome,callback:function(t){e.$set(e.consultaChat,"nome",t)},expression:"consultaChat.nome"}}),a("q-input",{staticClass:"q-pa-xs col-12 col-sm-5 col-md-2 col-lg-3",attrs:{label:"CPF",mask:"###.###.###-##",dense:""},model:{value:e.consultaChat.cpf,callback:function(t){e.$set(e.consultaChat,"cpf",t)},expression:"consultaChat.cpf"}}),a("q-input",{staticClass:"q-pa-xs col-12 col-sm-5 col-md-3 col-lg-3",attrs:{label:"Preceptor",dense:""},model:{value:e.consultaChat.preceptor,callback:function(t){e.$set(e.consultaChat,"preceptor",t)},expression:"consultaChat.preceptor"}}),a("q-btn",{staticClass:"q-pa-xs q-ma-md col-12 col-sm-3 col-md-2 col-lg-1",attrs:{label:"Consultar",type:"submit",color:"primary",dense:""}})],1)],1)],1),a("div",{staticClass:"row full-width"},[a("q-table",{staticClass:"col-5 on-right",staticStyle:{"margin-top":"4%"},attrs:{data:e.data,columns:e.columns,"row-key":"name",title:"Lista de Destinatários",pagination:e.pagination},on:{"update:pagination":function(t){e.pagination=t}},scopedSlots:e._u([{key:"body",fn:function(t){return[a("q-tr",{class:[e.tempoUltimaMsg(t.row.ultima_paciente)?"bg-warning":""],attrs:{props:t}},[a("q-td",{key:"id",attrs:{props:t}},[e._v("\n            "+e._s(t.row.id)+"\n          ")]),a("q-td",{key:"nome",attrs:{props:t}},[e._v("\n            "+e._s(t.row.nome)+"\n          ")]),a("q-td",{key:"cpf",attrs:{props:t}},[e._v("\n            "+e._s(t.row.cpf)+"\n          ")]),a("q-td",{key:"preceptor",attrs:{props:t}},[e._v("\n            "+e._s(t.row.preceptor)+"\n          ")]),a("q-td",{key:"ultima_paciente",attrs:{props:t}},[e.comparaDataMensagens(t.row.ultima_paciente,t.row.ultima_medico)?a("q-icon",{attrs:{name:"circle",color:"positive"}}):e._e(),e._v("\n            "+e._s(t.row.ultima_paciente)+"\n          ")],1),a("q-td",{key:"ultima_medico",attrs:{props:t}},[e._v("\n            "+e._s(t.row.ultima_medico)+"\n          ")]),a("q-td",{key:"acessar",attrs:{props:t}},[a("q-btn",{attrs:{flat:"",id:"btnAcessar",icon:"arrow_forward"},on:{click:function(a){e.carregarMensagens(t.row.id)}}})],1)],1)]}}])}),a("div",{staticClass:"col-6"},[a("MensagensChat",{attrs:{id_paciente:e.id_paciente}})],1)],1)],1)},n=[],o=a("ded3"),i=a.n(o),r=(a("e6cf"),a("5319"),a("29fe")),l=a("2f62"),c={name:"Chat",components:{MensagensChat:r["a"]},data(){return{id_paciente:null,pagination:{rowsPerPage:7},columns:[{name:"id",label:"Id",align:"left",field:e=>e.id,format:e=>`${e}`},{name:"nome",label:"Nome",align:"left",field:e=>e.nome,format:e=>`${e}`},{name:"cpf",label:"CPF",align:"left",field:e=>e.cpf,format:e=>`${e}`},{name:"preceptor",label:"Preceptor",align:"left",field:e=>e.preceptor,format:e=>`${e}`},{name:"ultima_paciente",label:"MSG Paciente",align:"left",field:e=>e.ultima_paciente,format:e=>`${e}`},{name:"ultima_medico",label:"MSG Médico",align:"left",field:e=>e.ultima_medico,format:e=>`${e}`},{name:"acessar",label:"Acessar",align:"left"}],data:[],consultaChat:{nome:"",cpf:"",preceptor:""}}},mounted(){this.carregarDestinatarios()},computed:i()({},Object(l["c"])("principal",["dadosUsuarioLogado"])),methods:{onSubmit(){this.carregarDestinatarios()},onReset(){},carregarDestinatarios(){return new Promise(((e,t)=>{let a=this.consultaChat;a.id_med_coord=this.dadosUsuarioLogado.id_usuario,a.cpf=a.cpf.replace(/[^0-9]+/g,""),this.$axios.post("/consultar_destinatarios",a).then((t=>{console.log("chat",t.data);let a=t.data.resultado.map((e=>({id:e.id_usuario,nome:e.nome,cpf:e.cpf,preceptor:e.nome_preceptor,ultima_paciente:e.ultima_paciente,ultima_medico:e.ultima_medico})));this.data=a,e(a)})).catch((e=>{this.$store.dispatch("principal/verificaErro",e),t(e)}))}))},carregarMensagens(e){console.log("id",e),this.id_paciente=e},comparaDataMensagens(e,t){if(null!=e&&null!=t){let a=e.substr(0,2),s=e.substr(3,2),n=e.substr(6,4),o=e.substr(11,2),i=e.substr(14,2),r=e.substr(17,2),l=new Date(n,s,a,o,i,r).getTime(),c=t.substr(0,2),m=t.substr(3,2),u=t.substr(6,4),d=t.substr(11,2),p=t.substr(14,2),g=t.substr(17,2),f=new Date(u,m,c,d,p,g).getTime(),h=l>f;return h}return!0},tempoUltimaMsg(e){if(null!=e){let t=e.substr(0,2),a=e.substr(3,2),s=e.substr(6,4),n=e.substr(11,2),o=e.substr(14,2),i=e.substr(17,2),r=new Date(s,a,t,n,o,i).getTime();console.log("ultima_paciente",r);let l=(new Date).getTime();console.log("hoje",l);let c=l-r;console.log("diferencaTimestamp",c);let m=c/864e5;return console.log("diferencaDias",m),m>15}return!0}}},m=c,u=a("2877"),d=a("9989"),p=a("1c1c"),g=a("3b73"),f=a("0378"),h=a("27f9"),b=a("9c40"),_=a("eaac"),w=a("bd08"),C=a("db86"),q=a("0016"),x=a("eebe"),v=a.n(x),y=Object(u["a"])(m,s,n,!1,null,null,null);t["default"]=y.exports;v()(y,"components",{QPage:d["a"],QList:p["a"],QExpansionItem:g["a"],QForm:f["a"],QInput:h["a"],QBtn:b["a"],QTable:_["a"],QTr:w["a"],QTd:C["a"],QIcon:q["a"]})}}]);